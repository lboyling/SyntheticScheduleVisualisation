
# Dynatrace Enterprise Synthetic Schedule Visualiser

When managing a Dynatrace Enterprise Synthetic deployment, it can be difficult to understand the behaviour of the synthetic agents when multiple transactions are assigned to them.
This is especially the case when there are tasks with different frequencies and overlapping schedules cause the execution of some tasks to be delayed.

This script was developed to make it easier to understand the behaviour of any Enterprise Synthetic deployment, by visually showing when transactions are run and how long they took to complete.

Features include the following:

* Multiple agents can be visualised on the same image, allowing comparison of the behaviour of different agents (especially agents at different sites).
* Start and end times are accurate to the second - long-running transactions can be easily spotted.
* Failed transactions are marked alongside their duration - helpful in identifying when failures cause agents to breach allocated capacity.

![Sample output of the visualiser script](/docs/sampleoutput.png?raw=true "Sample output of the visualiser script")

## How the script works

The visualiser PowerShell script takes advantage of the extended logging feature that the Enterprise Synthetic Framework offers (see https://community.dynatrace.com/community/display/ENTSYM124/Global+Tab for more information).
By parsing these logs, the script can identify when transactions start and end, and how long each transaction took to complete.
The script then generates a series of images. Each image represents a single hour of the day, and the transactions are drawn as rectangles in columns. Each vertical pixel corresponds to a single second - a rectangle that is 60 pixels tall represents a transaction that took a minute to complete in real time.

##Support and Prerequisites

* The script has primarily been tested using logs from version 12.2 of Enterprise Synthetic, and it has also been run against some sample logs from 12.3. There may be some changes to the log format in 12.3, 12.4 or future versions of Enterprise Synthetic, which may break the script.
* This script uses Powershell, and has been run using version 2.0 on Windows 7.

## How to run

1. Navigate to the folder where the compressed logs generated by the agents are stored (typically in the C:\ProgramData\Compuware\ClientVantage\Data\work\Data\UserData\PrintScreens\ folder for a single agent, or in a ..\Framework\PrintScreens\Logs\ folder on the agent manager).
2. Open the AgentName_Day.zip file and extract the AgentName_Day.log files to a temporary folder. Repeat for as many log files as you wish to compare.
3. Copy the visualiser.ps1 script into the same temporary folder as the extracted logs.
4. Open a command prompt and launch PowerShell. **By default, PowerShell does not allow execution of scripts downloaded from the internet or any other non-local source.** If not otherwise blocked by your domain's Group Policy settings, you can temporarily bypass the policy to run the script. To do this, open a Command Prompt and run `powershell -ExecutionPolicy bypass`. *It is recommended that you run this script in a sandbox or development machine which does not have unrestricted internet access*.
5. If you aren't in the folder where the script and logs are located, run `cd "path\to\script\folder"`
4. Run the script by typing `& .\visualiser.ps1` - it could take several minutes to parse the log files, especially for logs from busy agents.

## Output

An output folder is created, which contains a number of files:

1. 24 PNG files from (output0.png to output23.png) containing the visualisation of the schedule. Each file represents an hour of the day (in 24 hour time) - output14.png shows the transactions from 2PM to 3PM, for example.
2. A transactions.csv file, containing the list of transactions that the script identified from the logs. This can be imported into Excel or another application for further analysis.

